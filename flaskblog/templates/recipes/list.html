{% extends "layout.html" %}
{% block content %}
  <div class="d-flex justify-content-between align-items-center mb-3">
    <h1 class="h3 mb-0">Recipes</h1>
    {% if current_user.is_authenticated %}
      <a class="btn btn-dark" href="{{ url_for('recipes.recipe_new') }}">Submit recipe</a>
    {% endif %}
  </div>

  <form class="row g-2 mb-4" method="GET">
    <div class="col-md-4">
      <input class="form-control" name="search" placeholder="Search title/summary" value="{{ filters.search }}">
    </div>
    <div class="col-md-2">
      <select class="form-select" name="cuisine">
        <option value="">Cuisine</option>
        {% for c in cuisines %}
          <option value="{{ c }}" {% if filters.cuisine==c %}selected{% endif %}>{{ c }}</option>
        {% endfor %}
      </select>
    </div>
    <div class="col-md-2">
      <select class="form-select" name="difficulty">
        <option value="">Difficulty</option>
        {% for d in difficulties %}
          <option value="{{ d }}" {% if filters.difficulty==d %}selected{% endif %}>{{ d }}</option>
        {% endfor %}
      </select>
    </div>
    <div class="col-md-2">
      <input class="form-control" name="max_time" placeholder="Max mins" value="{{ filters.max_time }}">
    </div>
    <div class="col-md-2">
      <input class="form-control" name="ingredient" placeholder="Ingredient" value="{{ filters.ingredient }}">
    </div>
    <div class="col-md-3">
      <select class="form-select" name="tag">
        <option value="">Tag</option>
        {% for t in tags %}
          <option value="{{ t }}" {% if filters.tag==t %}selected{% endif %}>{{ t }}</option>
        {% endfor %}
      </select>
    </div>
    <div class="col-md-2">
      <button class="btn btn-outline-dark w-100" type="submit">Filter</button>
    </div>
    <div class="col-md-2">
      <a class="btn btn-outline-secondary w-100" href="{{ url_for('recipes.recipe_list') }}">Reset</a>
    </div>
  </form>

  {% if recipes.items|length == 0 %}
    <div class="alert alert-info">No recipes found. Try changing your filters.</div>
  {% endif %}

  <div class="row g-3">
    {% for recipe in recipes.items %}
      <div class="col-md-6 col-lg-4">
        <div class="card h-100">
          <img src="{{ url_for('static', filename='recipe_pics/' ~ recipe.image_file) }}" class="card-img-top" alt="Recipe image">
          <div class="card-body">
            <h5 class="card-title">{{ recipe.title }}</h5>
            {% if recipe.summary %}<p class="card-text">{{ recipe.summary }}</p>{% endif %}
            <div class="d-flex flex-wrap gap-2">
              {% if recipe.cook_time_mins %}<span class="badge badge-soft">⏱ {{ recipe.cook_time_mins }} mins</span>{% endif %}
              {% if recipe.difficulty %}<span class="badge badge-soft">{{ recipe.difficulty }}</span>{% endif %}
              {% if recipe.cuisine %}<span class="badge badge-soft">{{ recipe.cuisine }}</span>{% endif %}
            </div>
            {% if recipe.tags %}
              <div class="mt-2 d-flex flex-wrap gap-1">
                {% for t in recipe.tags %}
                  <a class="badge text-bg-light text-decoration-none" href="{{ url_for('recipes.recipe_list', tag=t.name) }}">#{{ t.name }}</a>
                {% endfor %}
              </div>
            {% endif %}
          </div>
          <div class="card-footer bg-white border-0">
            <a class="btn btn-outline-dark btn-sm" href="{{ url_for('recipes.recipe_detail', recipe_id=recipe.id) }}">View recipe</a>
          </div>
        </div>
      </div>
    {% endfor %}
  </div>

  <nav class="mt-4">
    <ul class="pagination">
      {% if recipes.has_prev %}
        <li class="page-item"><a class="page-link" href="{{ url_for('recipes.recipe_list', page=recipes.prev_num, **filters) }}">Previous</a></li>
      {% else %}
        <li class="page-item disabled"><span class="page-link">Previous</span></li>
      {% endif %}

      {% for page_num in recipes.iter_pages(left_edge=1, right_edge=1, left_current=1, right_current=2) %}
        {% if page_num %}
          {% if recipes.page == page_num %}
            <li class="page-item active"><span class="page-link">{{ page_num }}</span></li>
          {% else %}
            <li class="page-item"><a class="page-link" href="{{ url_for('recipes.recipe_list', page=page_num, **filters) }}">{{ page_num }}</a></li>
          {% endif %}
        {% else %}
          <li class="page-item disabled"><span class="page-link">…</span></li>
        {% endif %}
      {% endfor %}

      {% if recipes.has_next %}
        <li class="page-item"><a class="page-link" href="{{ url_for('recipes.recipe_list', page=recipes.next_num, **filters) }}">Next</a></li>
      {% else %}
        <li class="page-item disabled"><span class="page-link">Next</span></li>
      {% endif %}
    </ul>
  </nav>
{% endblock %}
