{% extends "layout.html" %}
{% block content %}

  <!-- HERO -->
  <div class="hero mb-4">
    <div class="row align-items-center g-3">
      <div class="col-lg-8">
        <h1 class="display-6 mb-2">Bonnyrigg High School Food Blog</h1>
        <p class="lead mb-3">
          Student recipes, cooking tips, and school favourites — curated for our school community.
        </p>

        <div class="d-flex flex-wrap gap-2 mb-3">
          <span class="chip">Recipes</span>
          <span class="chip">Search & Filters</span>
          <span class="chip">Comments</span>
          <span class="chip">Admin Moderation</span>
        </div>

        <div class="d-flex flex-wrap gap-2">
          <a class="btn btn-warning fw-semibold btn-pill" href="{{ url_for('recipes.recipe_list') }}">Browse recipes</a>
          {% if current_user.is_authenticated %}
            <a class="btn btn-outline-light btn-pill" href="{{ url_for('recipes.recipe_new') }}">Submit a recipe</a>
          {% else %}
            <a class="btn btn-outline-light btn-pill" href="{{ url_for('users.register') }}">Join the community</a>
          {% endif %}
        </div>
      </div>

      <div class="col-lg-4">
        <div class="stat">
          <div class="text-muted small">Quick start</div>
          <div class="fw-semibold">Try “Chicken Shawarma Wraps”</div>
          <div class="text-muted small">Great for lunch + easy steps</div>
          <a class="btn btn-sm btn-dark mt-2 btn-pill" href="{{ url_for('recipes.recipe_list', search='chicken') }}">Find it</a>
        </div>

        <div class="stat mt-3">
          <div class="text-muted small">Tip of the week</div>
          <div class="fw-semibold">Knife safety</div>
          <div class="text-muted small">Curl fingers, cut away, keep your board stable.</div>
          <a class="btn btn-sm btn-outline-dark mt-2 btn-pill" href="{{ url_for('main.tips') }}">Read tips</a>
        </div>
      </div>
    </div>
  </div>

  <!-- FEATURED CAROUSEL (goes directly under HERO) -->
  {% if featured and featured|length > 0 %}
    <div class="mb-4">
      <div class="d-flex justify-content-between align-items-center mb-2">
        <h2 class="h4 section-title mb-0">Featured Recipes</h2>
        <a class="btn btn-sm btn-outline-dark btn-pill"
           href="{{ url_for('recipes.recipe_list', tag='featured') }}">See all</a>
      </div>

      <div id="featuredCarousel" class="carousel slide" data-bs-ride="carousel">
        <div class="carousel-inner rounded-4 overflow-hidden">
          {% for r in featured %}
            <div class="carousel-item {% if loop.first %}active{% endif %}">
              <div class="featured-slide"
                data-bg="{{ url_for('static', filename='recipe_pics/' ~ r.image_file) }}">
                <div class="featured-overlay">
                  <div class="featured-card">
                    <div class="small text-muted">Featured</div>
                    <h3 class="h4 mb-1">{{ r.title }}</h3>
                    {% if r.summary %}<p class="text-muted mb-2">{{ r.summary }}</p>{% endif %}
                    <a class="btn btn-warning btn-pill fw-semibold"
                       href="{{ url_for('recipes.recipe_detail', recipe_id=r.id) }}">View recipe</a>
                  </div>
                </div>
              </div>
            </div>
          {% endfor %}
        </div>

        <button class="carousel-control-prev" type="button" data-bs-target="#featuredCarousel" data-bs-slide="prev">
          <span class="carousel-control-prev-icon"></span>
          <span class="visually-hidden">Previous</span>
        </button>

        <button class="carousel-control-next" type="button" data-bs-target="#featuredCarousel" data-bs-slide="next">
          <span class="carousel-control-next-icon"></span>
          <span class="visually-hidden">Next</span>
        </button>
      </div>
    </div>
  {% endif %}

  <!-- CATEGORY TILES -->
  <div class="row g-3 mb-4">
    <div class="col-md-3">
      <a class="tile" href="{{ url_for('recipes.recipe_list', difficulty='Easy') }}">
        <div class="tile-title">Easy Recipes</div>
        <div class="tile-sub">Perfect for beginners</div>
      </a>
    </div>
    <div class="col-md-3">
      <a class="tile" href="{{ url_for('recipes.recipe_list', max_time='30') }}">
        <div class="tile-title">Under 30 mins</div>
        <div class="tile-sub">Quick lunches & dinners</div>
      </a>
    </div>
    <div class="col-md-3">
      <a class="tile" href="{{ url_for('recipes.recipe_list', tag='vegetarian') }}">
        <div class="tile-title">Vegetarian</div>
        <div class="tile-sub">Meat-free favourites</div>
      </a>
    </div>
    <div class="col-md-3">
      <a class="tile" href="{{ url_for('recipes.recipe_list', tag='halal') }}">
        <div class="tile-title">Halal-friendly</div>
        <div class="tile-sub">Popular at school</div>
      </a>
    </div>
  </div>

  <div class="row g-4">
    <!-- MAIN: LATEST RECIPES -->
    <div class="col-lg-8">
      <div class="d-flex justify-content-between align-items-center mb-2">
        <h2 class="h4 section-title mb-0">Latest Recipes</h2>
        <a class="btn btn-sm btn-outline-dark btn-pill" href="{{ url_for('recipes.recipe_list') }}">View all</a>
      </div>

      {% if recipes.items|length == 0 %}
        <div class="alert alert-info">
          No recipes yet. Run <strong>python seed.py</strong> or submit one after registering.
        </div>
      {% endif %}

      <div class="row g-3">
        {% for recipe in recipes.items %}
          <div class="col-md-6">
            <div class="card h-100">
              <img src="{{ url_for('static', filename='recipe_pics/' ~ recipe.image_file) }}" class="card-img-top" alt="Recipe image">
              <div class="card-body">
                <h5 class="card-title mb-1">{{ recipe.title }}</h5>
                {% if recipe.summary %}<p class="card-text text-muted">{{ recipe.summary }}</p>{% endif %}

                <div class="d-flex flex-wrap gap-2">
                  {% if recipe.cook_time_mins %}<span class="badge text-bg-light badge-pill">⏱ {{ recipe.cook_time_mins }} mins</span>{% endif %}
                  {% if recipe.difficulty %}<span class="badge text-bg-light badge-pill">{{ recipe.difficulty }}</span>{% endif %}
                  {% if recipe.cuisine %}<span class="badge text-bg-light badge-pill">{{ recipe.cuisine }}</span>{% endif %}
                </div>

                {% if recipe.tags %}
                  <div class="mt-2 d-flex flex-wrap gap-1">
                    {% for t in recipe.tags %}
                      <a class="badge text-bg-warning text-decoration-none badge-pill"
                         href="{{ url_for('recipes.recipe_list', tag=t.name) }}">#{{ t.name }}</a>
                    {% endfor %}
                  </div>
                {% endif %}
              </div>

              <div class="card-footer bg-white border-0">
                <a class="btn btn-outline-dark btn-sm btn-pill"
                   href="{{ url_for('recipes.recipe_detail', recipe_id=recipe.id) }}">
                  View recipe
                </a>
              </div>
            </div>
          </div>
        {% endfor %}
      </div>

      <!-- Pagination -->
      <div class="mt-3">
        <nav>
          <ul class="pagination">
            {% if recipes.has_prev %}
              <li class="page-item"><a class="page-link" href="{{ url_for('main.home', page=recipes.prev_num) }}">Previous</a></li>
            {% else %}
              <li class="page-item disabled"><span class="page-link">Previous</span></li>
            {% endif %}

            <li class="page-item active"><span class="page-link">{{ recipes.page }}</span></li>

            {% if recipes.has_next %}
              <li class="page-item"><a class="page-link" href="{{ url_for('main.home', page=recipes.next_num) }}">Next</a></li>
            {% else %}
              <li class="page-item disabled"><span class="page-link">Next</span></li>
            {% endif %}
          </ul>
        </nav>
      </div>
    </div>

    <!-- SIDEBAR: QUICK SEARCH + TOP TAGS -->
    <div class="col-lg-4">
      <div class="panel mb-3">
        <div class="panel-title">Quick search</div>
        <form method="GET" action="{{ url_for('recipes.recipe_list') }}">
          <input class="form-control mb-2" name="search" placeholder="Search recipes (e.g. pasta)">
          <div class="d-grid">
            <button class="btn btn-dark btn-pill" type="submit">Search</button>
          </div>
        </form>
      </div>

      <div class="panel mb-3">
        <div class="panel-title">Top tags</div>
        <div class="d-flex flex-wrap gap-2">
          {% for t in top_tags %}
            <a class="tag-chip" href="{{ url_for('recipes.recipe_list', tag=t) }}">#{{ t }}</a>
          {% endfor %}
        </div>
      </div>

      <div class="panel">
        <div class="panel-title">Want to contribute?</div>
        <p class="text-muted mb-2">Share a recipe you love — keep it safe, school-appropriate, and clear.</p>
        {% if current_user.is_authenticated %}
          <a class="btn btn-warning w-100 btn-pill fw-semibold" href="{{ url_for('recipes.recipe_new') }}">Submit a recipe</a>
        {% else %}
          <a class="btn btn-warning w-100 btn-pill fw-semibold" href="{{ url_for('users.register') }}">Create an account</a>
        {% endif %}
      </div>
    </div>
  </div>

{% endblock %}
